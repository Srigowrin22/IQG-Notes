package training.iqgateway.controller;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import training.iqgateway.dto.VehicleDTO;
import training.iqgateway.entities.VehicleEO;
import training.iqgateway.service.VehicleService;

@RestController
@RequestMapping("/vehicle")
public class VehicleController {

    @Autowired
    private VehicleService vehicleService;

    @GetMapping("/all")
    public ResponseEntity<List<VehicleDTO>> getAllVehicles() {
        List<VehicleDTO> vehicles = vehicleService.findAllVehicles();
        return ResponseEntity.ok(vehicles);
    }

    @GetMapping("/{id}")
    public ResponseEntity<VehicleEO> getVehicleById(@PathVariable Integer id) {
        VehicleEO vehicle = vehicleService.findVehicleByID(id);
        if (vehicle != null) {
            return ResponseEntity.ok(vehicle);
        }
        return ResponseEntity.notFound().build();
    }

    @GetMapping("/type/{type}")
    public ResponseEntity<List<VehicleDTO>> getVehiclesByType(@PathVariable String type) {
        List<VehicleDTO> vehicles = vehicleService.findVehicleByType(type);
        return ResponseEntity.ok(vehicles);
    }

    @PostMapping("/add")
    public ResponseEntity<String> addVehicle(@RequestBody VehicleEO vehicleEO) {
        try {
            String msg = vehicleService.persistVehicleEO(vehicleEO);
            return ResponseEntity.status(HttpStatus.CREATED).body(msg);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.BAD_REQUEST).body("Error adding vehicle: " + e.getMessage());
        }
    }

    @PutMapping("/update")
    public ResponseEntity<String> updateVehicle(@RequestBody VehicleEO vehicleEO) {
        try {
            String msg = vehicleService.mergeVehicleEO(vehicleEO);
            return ResponseEntity.ok(msg);
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.BAD_REQUEST).body("Error updating vehicle: " + e.getMessage());
        }
    }

    @DeleteMapping("/delete/{id}")
    public ResponseEntity<String> deleteVehicle(@PathVariable Integer id) {
        try {
            Boolean deleted = vehicleService.removeVehicleEO(id);
            if (deleted) return ResponseEntity.ok("Vehicle deleted successfully");
            else return ResponseEntity.status(HttpStatus.BAD_REQUEST).body("Vehicle not found or could not delete");
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.BAD_REQUEST).body("Error deleting vehicle: " + e.getMessage());
        }
    }
}