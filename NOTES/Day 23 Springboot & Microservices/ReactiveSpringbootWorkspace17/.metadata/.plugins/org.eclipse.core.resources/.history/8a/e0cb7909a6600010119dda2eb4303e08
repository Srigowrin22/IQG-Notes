//package training.iqgateway.controller;
//
//import java.util.List;
//
//import org.springframework.beans.factory.annotation.Autowired;
//import org.springframework.http.HttpStatus;
//import org.springframework.http.ResponseEntity;
//import org.springframework.web.bind.annotation.CrossOrigin;
//import org.springframework.web.bind.annotation.DeleteMapping;
//import org.springframework.web.bind.annotation.GetMapping;
//import org.springframework.web.bind.annotation.PathVariable;
//import org.springframework.web.bind.annotation.PostMapping;
//import org.springframework.web.bind.annotation.PutMapping;
//import org.springframework.web.bind.annotation.RequestBody;
//import org.springframework.web.bind.annotation.RequestMapping;
//import org.springframework.web.bind.annotation.RestController;
//
//import training.iqgateway.dto.AdminDTO;
//import training.iqgateway.dto.RolesDTO;
//import training.iqgateway.entities.AdminEO;
//import training.iqgateway.entities.RoleEO;
//import training.iqgateway.service.AdminService;
//
//@RestController
////@RequestMapping("/api/admin")
////@CrossOrigin(origins = "url")
//public class AdminController {
//
//	@Autowired
//	private AdminService adminServiceRef;
//
//	@GetMapping("/showAdmins")
//	public List<AdminDTO> fetchAllAdmin() {
//		return adminServiceRef.getAdminEOFindAll();
//	}
//	
//	@PostMapping("/addAdmin")
//	public ResponseEntity<AdminEO> addAdmin(@RequestBody AdminEO adminEO) {
//	    try {
//	        AdminEO savedAdmin = adminServiceRef.persistAdminEO(adminEO);
//	        // Return 201 Created with saved entity in body
//	        return ResponseEntity.status(HttpStatus.CREATED).body(savedAdmin);
//	    } catch (Exception e) {
//	        // Log the error if needed
//	        // Return 400 Bad Request or 500 Internal Server Error as appropriate
//	        return ResponseEntity.status(HttpStatus.BAD_REQUEST).build();
//	    }
//	}
//
////
////	@PostMapping("/addAdmin")
////	public AdminEO addAdmin(@RequestBody AdminEO adminEO) {
////		return adminServiceRef.persistAdminEO(adminEO);
////	}
//
//	@PutMapping("/updateAdmin")
//	public String updateRole(@RequestBody AdminEO adminEO) {
//		return adminServiceRef.mergeAdminEO(adminEO);
//	}
//
//	// TODO
//
//	@GetMapping("/findByAdminByRoleID/{roleId}")
//	public List<AdminEO> findAdminByRoleID(@PathVariable Long roleId) {
//		return adminServiceRef.findAdminByRoleID(roleId);
//	}
//
//	@GetMapping("/showRoles")
//	public List<RolesDTO> fetchAllRoles() {
//		return adminServiceRef.getRoleEOFindAll();
//	}
//
//	@PostMapping("/addRole")
//	public String addRole(@RequestBody RoleEO roleEO) {
//		String res = adminServiceRef.persistRoleEO(roleEO);
//		return res;
//	}
//
//	@PutMapping("/updateRole")
//	public String updateRole(@RequestBody RoleEO roleEO) {
//		return adminServiceRef.mergeRoleEO(roleEO);
//	}
//
//	@DeleteMapping("/deleteRole")
//	public Boolean deleteRole(@RequestBody RoleEO roleEO) {
//		return adminServiceRef.removeRoleEO(roleEO);
//	}
//
//	@GetMapping("/findByRoleID/{roleId}")
//	public RoleEO findByRoleID(@PathVariable Long roleId) {
//		return adminServiceRef.findRoleByRoleID(roleId);
//	}
//
//	@GetMapping("/findByRoleName/{roleName}")
//	public RoleEO findByRoleName(@PathVariable String roleName) {
//		return adminServiceRef.findRoleByRoleName(roleName);
//	}
//
//}

package training.iqgateway.service.impl;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import javax.validation.Valid;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import training.iqgateway.dto.AdminDTO;
import training.iqgateway.dto.RolesDTO;
import training.iqgateway.entities.AdminEO;
import training.iqgateway.entities.RoleEO;
import training.iqgateway.repository.AdminRepository;
import training.iqgateway.repository.RolesRepository;
import training.iqgateway.service.AdminService;

@Service
public class AdminServiceImpl implements AdminService {

    @Autowired
    private RolesRepository rolesRepositoryRef;

    @Autowired
    private AdminRepository adminRepositoryRef;

    @Override
    public AdminEO persistAdminEO(@Valid AdminEO adminEO) {
        Long maxId = Optional.ofNullable(adminRepositoryRef.findMaxId()).orElse(0L);
        Long newId = maxId + 1;
        adminEO.setId(newId);
        return adminRepositoryRef.save(adminEO);
    }

    @Override
    public String mergeAdminEO(@Valid AdminEO adminEO) {
        AdminEO existingAdmin = adminRepositoryRef.findByDesignationId(adminEO.getDesignationId())
                .orElseThrow(() -> new RuntimeException("Admin Not Found with designationId: " + adminEO.getDesignationId()));

        RoleEO roleEO = rolesRepositoryRef.findById(adminEO.getRole().getRoleId())
                .orElseThrow(() -> new RuntimeException("Role not found: " + adminEO.getRole().getRoleName()));

        // Update existing admin fields
        existingAdmin.setRole(roleEO);
        existingAdmin.setName(adminEO.getName());
        existingAdmin.setGender(adminEO.getGender());
        existingAdmin.setAadhar(adminEO.getAadhar());
        existingAdmin.setPhone(adminEO.getPhone());
        existingAdmin.setPassword(adminEO.getPassword());
        existingAdmin.setHireDate(adminEO.getHireDate());
        existingAdmin.setSignup(adminEO.getSignup());

        adminRepositoryRef.save(existingAdmin);
        return "Admin updated successfully";
    }

    @Override
    public Boolean removeAdminEO(AdminEO adminEO) {
        if (adminEO == null || adminEO.getId() == null) {
            throw new IllegalArgumentException("Admin or Admin ID must not be null");
        }
        adminRepositoryRef.delete(adminEO);
        return true;
    }

    @Override
    public int authorizeAdmin(String designationId, String password, String newPassword) {
        // TODO: Implement authorization logic (e.g., verify password, update password)
        return 0;
    }

    @Override
    public List<AdminDTO> getAdminEOFindAll() {
        List<AdminEO> adminEOList = adminRepositoryRef.findAll();
        List<AdminDTO> adminDTOList = new ArrayList<>();
        for (AdminEO adm : adminEOList) {
            AdminDTO dto = new AdminDTO(adm.getId(), adm.getRole().getRoleName(), adm.getDesignationId(), adm.getName(),
                    adm.getGender(), adm.getAadhar(), adm.getPhone(), adm.getPassword(), adm.getHireDate(),
                    adm.getSignup());
            adminDTOList.add(dto);
        }
        return adminDTOList;
    }

    @Override
    public AdminEO findAdminByDesigID(String designationId) {
        return adminRepositoryRef.findByDesignationId(designationId).orElse(null);
    }

    @Override
    public AdminEO findAdminByAadhar(String aadhar) {
        return adminRepositoryRef.findByAadhar(aadhar).orElse(null);
    }

    @Override
    public List<AdminEO> findAdminByRoleID(Long roleId) {
        return adminRepositoryRef.findByRoleRoleId(roleId);
    }

    @Override
    public List<AdminEO> findAdminByName(String name) {
        return adminRepositoryRef.findByNameContainingIgnoreCase(name);
    }

    @Override
    public String persistRoleEO(@Valid RoleEO roleEO) {
        rolesRepositoryRef.save(roleEO);
        return "Role created successfully";
    }

    @Override
    public String mergeRoleEO(@Valid RoleEO roleEO) {
        rolesRepositoryRef.save(roleEO);
        return "Role updated successfully";
    }

    @Override
    public Boolean removeRoleEO(RoleEO roleEO) {
        if (roleEO == null || roleEO.getRoleId() == null) {
            throw new IllegalArgumentException("Role or Role ID must not be null");
        }
        rolesRepositoryRef.delete(roleEO);
        return true;
    }

    @Override
    public List<RolesDTO> getRoleEOFindAll() {
        List<RoleEO> roles = rolesRepositoryRef.findAll();
        List<RolesDTO> rolesDTO = new ArrayList<>();
        for (RoleEO role : roles) {
            RolesDTO dto = new RolesDTO(role.getRoleId(), role.getRoleName());
            rolesDTO.add(dto);
        }
        return rolesDTO;
    }

    @Override
    public RoleEO findRoleByRoleID(Long roleId) {
        return rolesRepositoryRef.findById(roleId).orElse(null);
    }

    @Override
    public RoleEO findRoleByRoleName(String roleName) {
        return rolesRepositoryRef.findByRoleName(roleName);
    }

    @Override
    public Boolean login(AdminEO adminEO) {
        // TODO: Implement login logic (e.g., check designationId and password)
        return null;
    }
}
