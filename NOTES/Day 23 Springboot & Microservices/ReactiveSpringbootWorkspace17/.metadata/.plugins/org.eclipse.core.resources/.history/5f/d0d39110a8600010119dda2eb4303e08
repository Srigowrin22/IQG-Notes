//package training.iqgateway.service.impl;
//
//import java.util.ArrayList;
//import java.util.List;
//
//import org.springframework.beans.factory.annotation.Autowired;
//import org.springframework.stereotype.Service;
//import training.iqgateway.dto.AdminDTO;
//import training.iqgateway.dto.RolesDTO;
//import training.iqgateway.entities.AdminEO;
//import training.iqgateway.entities.RoleEO;
//import training.iqgateway.repository.AdminRepository;
//import training.iqgateway.repository.RolesRepository;
//import training.iqgateway.service.AdminService;
//
//@Service
//public class AdminServiceImpl implements AdminService {
//
//	@Autowired
//	private RolesRepository rolesRepositoryRef;
//
//	@Autowired
//	private AdminRepository adminRepositoryRef;
//
//	@Override
//	public AdminEO persistAdminEO(AdminEO adminEO) {
//		Long maxId = adminRepositoryRef.findMaxId();
//		Long newId = maxId + 1;
//		adminEO.setId(newId);
//		return adminRepositoryRef.save(adminEO);
//	}
//
//	public String mergeAdminEO(AdminEO adminEO) {
//		AdminEO existingAdmin = adminRepositoryRef.findByDesignationId(adminEO.getDesignationId())
//				.orElseThrow(() -> new RuntimeException("Admin Not Found" + adminEO.getDesignationId()));
//		RoleEO roleEO = rolesRepositoryRef.findById(adminEO.getRole().getRoleId())
//				.orElseThrow(() -> new RuntimeException("Role not found: " + adminEO.getRole().getRoleName()));
//		AdminEO admin = new AdminEO(adminEO.getId(), adminEO.getRole(), adminEO.getDesignationId(), adminEO.getName(),
//				adminEO.getGender(), adminEO.getAadhar(), adminEO.getPhone(), adminEO.getPassword(),
//				adminEO.getHireDate(), adminEO.getSignup());
//		adminRepositoryRef.save(admin);
//		return "Admin updated successfully";
//	}
//
//	public Boolean removeAdminEO(AdminEO adminEO) {
//		// TODO Auto-generated method stub
//		return null;
//	}
//
//	public int authorizeAdmin(String designationId, String password, String newPassword) {
//		// TODO Auto-generated method stub
//		return 0;
//	}
//
//	public List<AdminDTO> getAdminEOFindAll() {
//		List<AdminEO> adminEO = adminRepositoryRef.findAll();
//		List<AdminDTO> adminDTO = new ArrayList<AdminDTO>();
//		for (AdminEO adm : adminEO) {
//			AdminDTO dto = new AdminDTO(adm.getId(), adm.getRole().getRoleName(), adm.getDesignationId(), adm.getName(),
//					adm.getGender(), adm.getAadhar(), adm.getPhone(), adm.getPassword(), adm.getHireDate(),
//					adm.getSignup());
//			adminDTO.add(dto);
//		}
//		return adminDTO;
//	}
//
//	public AdminEO findAdminByDesigID(String designationId) {
//		// TODO Auto-generated method stub
//		return null;
//	}
//
//	public AdminEO findAdminByAadhar(String aadhar) {
//		// TODO Auto-generated method stub
//		return null;
//	}
//
//	public List<AdminEO> findAdminByRoleID(Long roleId) {
//		return adminRepositoryRef.findByRoleRoleId(roleId);
//	}
//
//	public List<AdminEO> findAdminByName(String name) {
//		// TODO Auto-generated method stub
//		return null;
//	}
//
//	public String persistRoleEO(RoleEO roleEO) {
//		rolesRepositoryRef.save(roleEO);
//		return "Success";
//	}
//
//	public String mergeRoleEO(RoleEO roleEO) {
//		rolesRepositoryRef.save(roleEO);
//		return "Updated";
//	}
//
//	public Boolean removeRoleEO(RoleEO roleEO) {
//		rolesRepositoryRef.delete(roleEO);
//		return true;
//	}
//
//	public List<RolesDTO> getRoleEOFindAll() {
//		List<RoleEO> roles = rolesRepositoryRef.findAll();
//		List<RolesDTO> rolesDTO = new ArrayList<RolesDTO>();
//		for (RoleEO role : roles) {
//			RolesDTO dto = new RolesDTO(role.getRoleId(), role.getRoleName());
//			rolesDTO.add(dto);
//		}
//		return rolesDTO;
//	}
//
//	public RoleEO findRoleByRoleID(Long roleId) {
//		return rolesRepositoryRef.findById(roleId).orElse(null);
//	}
//
//	public RoleEO findRoleByRoleName(String roleName) {
//		return rolesRepositoryRef.findByroleName(roleName);
//	}
//
//	public Boolean login(AdminEO adminEO) {
//		return null;
//	}
//
//}


package training.iqgateway.service.impl;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import training.iqgateway.dto.AdminDTO;
import training.iqgateway.dto.RolesDTO;
import training.iqgateway.entities.AdminEO;
import training.iqgateway.entities.RoleEO;
import training.iqgateway.repository.AdminRepository;
import training.iqgateway.repository.RolesRepository;
import training.iqgateway.service.AdminService;

@Service
public class AdminServiceImpl implements AdminService {

    @Autowired
    private RolesRepository rolesRepositoryRef;

    @Autowired
    private AdminRepository adminRepositoryRef;

    @Override
    public AdminEO persistAdminEO(@Valid AdminEO adminEO) {
        Long maxId = Optional.ofNullable(adminRepositoryRef.findMaxId()).orElse(0L);
        Long newId = maxId + 1;
        adminEO.setId(newId);
        return adminRepositoryRef.save(adminEO);
    }

    @Override
    public String mergeAdminEO(@Valid AdminEO adminEO) {
        AdminEO existingAdmin = adminRepositoryRef.findByDesignationId(adminEO.getDesignationId())
                .orElseThrow(() -> new RuntimeException("Admin Not Found with designationId: " + adminEO.getDesignationId()));

        RoleEO roleEO = rolesRepositoryRef.findById(adminEO.getRole().getRoleId())
                .orElseThrow(() -> new RuntimeException("Role not found: " + adminEO.getRole().getRoleName()));

        // Update existing admin fields
        existingAdmin.setRole(roleEO);
        existingAdmin.setName(adminEO.getName());
        existingAdmin.setGender(adminEO.getGender());
        existingAdmin.setAadhar(adminEO.getAadhar());
        existingAdmin.setPhone(adminEO.getPhone());
        existingAdmin.setPassword(adminEO.getPassword());
        existingAdmin.setHireDate(adminEO.getHireDate());
        existingAdmin.setSignup(adminEO.getSignup());

        adminRepositoryRef.save(existingAdmin);
        return "Admin updated successfully";
    }

    @Override
    public Boolean removeAdminEO(AdminEO adminEO) {
        if (adminEO == null || adminEO.getId() == null) {
            throw new IllegalArgumentException("Admin or Admin ID must not be null");
        }
        adminRepositoryRef.delete(adminEO);
        return true;
    }

    @Override
    public int authorizeAdmin(String designationId, String password, String newPassword) {
        // TODO: Implement authorization logic (e.g., verify password, update password)
        return 0;
    }

    @Override
    public List<AdminDTO> getAdminEOFindAll() {
        List<AdminEO> adminEOList = adminRepositoryRef.findAll();
        List<AdminDTO> adminDTOList = new ArrayList<>();
        for (AdminEO adm : adminEOList) {
            AdminDTO dto = new AdminDTO(adm.getId(), adm.getRole().getRoleName(), adm.getDesignationId(), adm.getName(),
                    adm.getGender(), adm.getAadhar(), adm.getPhone(), adm.getPassword(), adm.getHireDate(),
                    adm.getSignup());
            adminDTOList.add(dto);
        }
        return adminDTOList;
    }

    @Override
    public AdminEO findAdminByDesigID(String designationId) {
        return adminRepositoryRef.findByDesignationId(designationId).orElse(null);
    }

    @Override
    public AdminEO findAdminByAadhar(String aadhar) {
        return (AdminEO) adminRepositoryRef.findByaadhar(aadhar).orElse(null);
    }

    @Override
    public List<AdminEO> findAdminByRoleID(Long roleId) {
        return adminRepositoryRef.findByRoleRoleId(roleId);
    }

    @Override
    public List<AdminEO> findAdminByName(String name) {
        return adminRepositoryRef.findByname(name);
    }

    @Override
    public String persistRoleEO(@Valid RoleEO roleEO) {
        rolesRepositoryRef.save(roleEO);
        return "Role created successfully";
    }

    @Override
    public String mergeRoleEO(@Valid RoleEO roleEO) {
        rolesRepositoryRef.save(roleEO);
        return "Role updated successfully";
    }

    @Override
    public Boolean removeRoleEO(RoleEO roleEO) {
        if (roleEO == null || roleEO.getRoleId() == null) {
            throw new IllegalArgumentException("Role or Role ID must not be null");
        }
        rolesRepositoryRef.delete(roleEO);
        return true;
    }

    @Override
    public List<RolesDTO> getRoleEOFindAll() {
        List<RoleEO> roles = rolesRepositoryRef.findAll();
        List<RolesDTO> rolesDTO = new ArrayList<>();
        for (RoleEO role : roles) {
            RolesDTO dto = new RolesDTO(role.getRoleId(), role.getRoleName());
            rolesDTO.add(dto);
        }
        return rolesDTO;
    }

    @Override
    public RoleEO findRoleByRoleID(Long roleId) {
        return rolesRepositoryRef.findById(roleId).orElse(null);
    }

    @Override
    public RoleEO findRoleByRoleName(String roleName) {
        return rolesRepositoryRef.findByroleName(roleName);
    }

    @Override
    public Boolean login(AdminEO adminEO) {
        // TODO: Implement login logic (e.g., check designationId and password)
        return null;
    }
}
